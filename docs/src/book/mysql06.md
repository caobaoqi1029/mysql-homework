---
title: MySQL 数据操纵功能
order: 6
icon: /mysql-item.svg
category:
  - BOOK
  - MD
---

MySQL 的数据操纵功能是指对数据库中的数据的查询、添加、删除和修改操作，使用的命令分别为 SELECT、INSERT、DELETE 和 UPDATE，这也是事务用户对数据库进行操作时使用最多的四个命令。本章将重点介绍 

- SELECT 命令的基本格式
- 四种不同类型的查询
  - 单表查询
  - 多表连接查询
  - 嵌套查询和分组查询

然后介绍 INSERT、DELETE 和 UPDATE 的基本格式。

## 一、简单查询-单表

SELECT语句是数据库操作中最基本和最重要的语句之一，其功能是从数据库中检索满足用户需要的数据。用户可以根据表中的一个或多个字段建立查询条件，以便从数据库中检索出符合条件的记录。

- 查询的数据源可以是一张表，也可以是多张表，甚至可以是视图
- 查询的结果是由满足条件的若干记录中的指定字段组成

这样用户可以根据需要获取特定的数据信息因此，SELECT 语句在数据库操作中扮演着非常重要的角色，它允许用户根据特定条件从数据库中提取所需的数据，为数据分析和应用提供了基础支持。

### 1.1 查询语句的基本格式

查询语句包括五个子句：SELECT、FROM、WHERE、GROUP BY和 ORDER BY。这些子句用于指定查询的目标字段、数据源、查询条件、分组方式和排序方式。完整的语法格式如下 :

```sql
SELECT 目标字段 | 字段表达式或函数
FROM 数据源
[WHERE <元组选择条件>]
[GROUP BY <分组字段>] [HAVING <组选择条件>]
[ORDER BY <排序字段>] [ASC | DESC]
```

其中 SELECT 和 FROM 为必选子句，WHERE、GROUP BY、HAVING 和 ORDER BY 为可选子句，每个子句的功能如下: 

- SELECT 子句用于指定输出的字段名，可以是单个字段或多个字段，当输出多个字段时，字段名之间用逗号隔开
  - 如果要输出表中的所有字段，可以使用 ==*== 代替所有的字段名
  - 此外，如果查询结果中有重复行，可以在字段名列表前使用 ==DISTINCT== 操作符去掉重复行
  - **该子句还可以指定要输出的字段表达式或函数**，例如：将学生选课成绩提高 10% 输出以及输出学生选课平均成绩等
- FROM 用于指定数据源，即要从哪个表或视图中进行查询，当需要从多个数据源进行查找时，需要将表之间按关联字段进行等值连接的操作
- WHERE 用于指定查询的条件，即根据哪些条件来筛选数据，表中满足条件的元组将被输出，当有多个查询条件时应在多个条件之间使用 AND 或 OR 操作符进行连接
- GROUP BY 是将满足 WHERE 条件的记录进行分组 (如果没有 WHERE 子句，则将表中所有记录进行分组)，再对每组中的巨鹿按指定字段使用指定函数进行统计并输出。若其后还有 HAVING 选项，则需要先按照 HAVING 选项中的组选择条件对各组进行筛选，满足条件的组才统计输出
- ORDER BY 用于对查询结果进行排序，可以指定一个或多个字段进行排序，并可以指定升序（ASC）或降序（DESC）当有多个排序字段时，会先按字段名 1 的值进行排序，字段名 1 的值相同时按字段名 2 的值进行排序，以此类推。其语法格式如下:

```sql
字段名 1 [ASC | DESC] ,字段名 2 [ASC | DESC] [,···字段名 n [ASC | DESC] ]
```

### 1.2 SELECT 语句中的操作符

SELECT 语句中的操作符包括

- 算数操作符、比较操作符
- 逻辑操作符、集合操作符
- 其他操作

### - 算术操作符

算术操作符是 SQL 中最基本的操作运算符，用于各类数值计算，主要有 + (加)、- (减)、* (乘)、/ (除)、和 % (求余或模)

### - 比较操纵符

比较运算符经常在 SELECT 的查询条件子句中使用，用来查询满足指定条件的记录。主要包括 >、<、=、>=、<=、!=、以及IN、BETWEEN AND、IS NULL、LIKE 和 EXISTS，用比较运算符连接的表达式其返回值只能是 1 代表结果为真、0 代表结果为假或 NULL 代表比较结果不确定

> IN | NOT IN 操作符

语法格式：

```sql
<字段> [NOT] IN (列表值 | 子查询)
```

含义：

将字段值与列表值或子查询的结果集进行比较，若字段值在 [不在] 列表值或结果集中则返回 1 [0]

示例：

> BETWEEN AND

语法格式：

```sql
<字段> [NOT] BETWEEN 值1 AND 值2
```

含义：

将字段值与值1 和 值2 进行比较，若字段值在 [不在] 两个值之间(包含 值1 和 值2)则返回 1 [0]

示例：



> IS NULL | IS NOT NULL

语法格式：

```sql
<字段> IS [NOT] NULL
```

含义：

判断字段是 [不是] 空值，若是 [不是] 空值，则返回值为 1 [0]

示例：

> LIKE

语法格式：

```sql
<字段> [NOT] LIKE 通配符表达式
```

含义：

判断字段值是 [不是] 与通配符表达式匹配，若匹配则返回值 1 [0]，其中进行比较的字段类型必须是字符串型通配符有:

- 百分号 ==%== 代表可以匹配任意数目 (包括 0)
- 下划线 ==_==  代表只能匹配单个字符

示例：

> EXISTS

语法格式：

```sql
[NOT] EXISTS (<子查询>)
```

含义：

判断子查询的结果集是否为空

示例：



### - 逻辑操作符

用于逻辑运算，包括

- 与运算（ AND 或 &&）
- 或运算（ OR 或 1或！）
- 非运算 (NOT 或 !)
- 任何一个（ ANY) 和 每个（ ALL) 

> AND

语法格式：

```sql
条件表达式 1 AND 条件表达式 2 
```

含义：

判断条件表达式 1 和条件表达式 2 是否都成立，若是则返回值为 1 ，否则返回值为 0

示例：

>  OR

语法格式：

```sql
条件表达式 1 OR 条件表达式 2
```

含义：

判断两个条件表达式中是否有一个成立，若是则返回值为 1 ，否则返回值为 0



示例：

> NOT

语法格式：

```sql
NOT 条件表达式
```

含义：

判断条件表达式是否不成立，若是则返回值为 1 ，否则返回值为 0

示例：

> ANY

语法格式：

```sql
<字段><比较运算符> ANY （列表值 | 子查询）
```

含义：

将字段值与列表值或子查询结果集中任何一个值进行比较，若满足比较运算符给出的条件，则返回值为 1 ，否则返回值为 0

示例：

### - 集合操作符

集合操作符包括：

- 并运算（ UNION) 
- 交运算（ INTERSECT) 
- 差运算（ EXCEPT) 

但目前 MySQL 只支持 UNION 操作符，不支持 INTERSECT 和 EXCEPT 操作符

> UNION

语法格式：

```sql
列表值 1 | 子查询 1 UNION 列表值2 |子查询2
```

含义：

将两个列表值或两个子查询的结果集进行并运算，返回值为并运算的结果

示例：

### - 其它操作符

1. ==*== 操作符是一个表中的所有字段的简写，一般用在查询语句的 SELECT 子句中，表示要输出表中全部字段
2. ALL 操作符 ALL 一般用在查询语句 SELECT 子句的目标列前，说明在查洵结果中保留重复行
3. DISTINCT 一般用在查询语句 SELECT 子句的目标列前，说明在查询结果中去掉重复行

### 1.3 不带 WHERE 条件的查询

###  - 输出所有字段



### - 输出表中指定字段



### - 用 ALL 或 DISTINCT 操作符



### - SELECT 子句中用字段表达式或函数



### 1.4 带 WHERE 条件的查询

### - 使用比较操作符的条件查询



### - 使用 IN 操作符的条件查询



### - 使用 BETWEEN...AND 操作符的条件查询



### - 使用 LIKE 操作符的条件查询



### - 使用 AND 或 OR 连接多个条件表达式



### 1.5 查询结果的排序



## 二、连接查询-多表

### 2.1 内连接中的等值连接和自然连接

### - 等值连接



### - 自然连接



### 2.2 内连接和外连接的区别



### 自身连接



## 三、嵌套查询-子查询

### 3.1 用 IN 操作符的子查询



### 3.2 用比较运算符的子查询



### 3.3 用 ANY 或 ALL 运算符的子查询



### 3.4 用 EXISTS 操作符的子查询



### 3.5 子查询的局限性 



## 四、分组和函数查询

### 4.1 SQL 聚合函数



### 4.2 GROUP BY 实现分组查询



### 4.3 带 HAVING 子句的分组条件查询





## 五、添加、删除和修改数据
